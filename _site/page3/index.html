<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      msdalp &middot; java, android, etc.
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="msdalp" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
      <h3 class="masthead-title">
<a href="/" title="Home">msdalp</a>
<small>java, android, etc.</small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/about">About</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/archive">Archive</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/atom.xml">Feed</a></small>


</h3>

      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2014/03/04/jetty-embedded/">
        Jetty Embedded Server With Post, Get, and Gson
      </a>
    </h1>

    <time datetime="2014-03-04T18:40:24+02:00" class="post-date">04 Mar 2014</time>

    <p>Jetty is used in a wide variety of projects and products, both in development and production. Jetty can be easily embedded in devices, tools, frameworks, application servers, and clusters. See the <a href="http://www.eclipse.org/jetty/powered">Jetty Powered page</a> for more uses of Jetty.Here we want to use it as an embedded web server that runs with our application.
You should first download the required jetty jar files and import them. Basically you can just down <a href="http://repo1.maven.org/maven2/org/eclipse/jetty/aggregate/jetty-all/9.1.0.v20131115/jetty-all-9.1.0.v20131115.jar">jetty all</a> and use it there will no problem. For now the latest version is the 9.1 and it is the one we will use.Also Gson will be used and you should download it from <a href="https://code.google.com/p/google-gson/downloads/detail?name=google-gson-2.2.4-release.zip&amp;can=2&amp;q=">this</a> link.
First create a class that extends Server and by giving port to its constructor we will be able to start it easily.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">msd</span><span class="o">.</span><span class="na">jetty</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.GsonBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.jetty.server.Server</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.jetty.servlet.ServletContextHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.jetty.servlet.ServletHolder</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Jetty</span> <span class="kd">extends</span> <span class="n">Server</span> <span class="o">{</span>
 
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GsonBuilder</span><span class="o">().</span>
    <span class="n">setDateFormat</span><span class="o">(</span><span class="s">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="o">).</span><span class="na">create</span><span class="o">();</span>
 
    <span class="kd">public</span> <span class="nf">Jetty</span><span class="o">(</span><span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
 
        <span class="n">ServletContextHandler</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ServletContextHandler</span><span class="o">(</span><span class="n">ServletContextHandler</span>
        <span class="o">.</span><span class="na">NO_SESSIONS</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">setContextPath</span><span class="o">(</span><span class="s">&quot;/test&quot;</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">addServlet</span><span class="o">(</span><span class="k">new</span> <span class="nf">ServletHolder</span><span class="o">(</span><span class="k">new</span> <span class="nf">GetName</span><span class="o">(</span><span class="n">gson</span><span class="o">)),</span> <span class="s">&quot;/GetName/*&quot;</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">addServlet</span><span class="o">(</span><span class="k">new</span> <span class="nf">ServletHolder</span><span class="o">(</span><span class="k">new</span> <span class="nf">SaveName</span><span class="o">()),</span> <span class="s">&quot;/SaveName/*&quot;</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">setHandler</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">setStopAtShutdown</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre></div>

<p>By using context.addServlet() method you can add servlets easily.addServlet() takes two parameters and the first one is the class name that will be called when this servlet called and the second one is the name how you will call it.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">context</span><span class="o">.</span><span class="na">addServlet</span><span class="o">(</span><span class="k">new</span> <span class="nf">ServletHolder</span><span class="o">(</span><span class="k">new</span> <span class="nf">SaveName</span><span class="o">()),</span> <span class="s">&quot;/SaveName/*&quot;</span><span class="o">);</span></code></pre></div>

<p>will be called as localhost:portNumber/test/SaveName 
GET methods are defined using doGet and POST methods are defined with doPost.SaveName and GetName classes are</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">msd</span><span class="o">.</span><span class="na">jetty</span><span class="o">;</span>
 
 
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
 
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;serial&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SaveName</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="nf">SaveName</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
                                             <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="kt">long</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
            <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">);</span>
            <span class="kd">final</span> <span class="n">String</span> <span class="n">surName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;surName&quot;</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;name:&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot; surname:&quot;</span><span class="o">+</span><span class="n">surName</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">);</span>
 
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_INTERNAL_SERVER_ERROR</span><span class="o">);</span>
 
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre></div>

<p>And the get method we will use:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">msd</span><span class="o">.</span><span class="na">jetty</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.JsonObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
 
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;serial&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetName</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
 
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Gson</span> <span class="n">gson</span><span class="o">;</span>
 
    <span class="kd">public</span> <span class="nf">GetTeamDictionary</span><span class="o">(</span><span class="n">Gson</span> <span class="n">gson</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">gson</span> <span class="o">=</span> <span class="n">gson</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> 
                                            <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">JsonObject</span> <span class="n">retVal</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JsonObject</span><span class="o">();</span>
            
            <span class="n">retVal</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;jetty&quot;</span><span class="o">);</span>
            <span class="n">retVal</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;surname&quot;</span><span class="o">,</span> <span class="s">&quot;is awasome&quot;</span><span class="o">);</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">retVal</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">);</span>
 
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_INTERNAL_SERVER_ERROR</span><span class="o">);</span>
 
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre></div>

<p>It’s all that simple and now you only need to start to jetty server from your main class.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">msd</span><span class="o">.</span><span class="na">jetty</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">Jetty</span> <span class="n">jetty</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Jetty</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
            <span class="n">jetty</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">false</span> <span class="o">==</span> <span class="n">jetty</span><span class="o">.</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">&quot;Cannot start jetty server&quot;</span><span class="o">);</span>
            <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>When your application is running you can call localhost:8080/test/GetName and it will return to you a json object like this</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;jetty&quot;</span><span class="p">,</span>
  <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;is awesome&quot;</span>
<span class="p">}</span></code></pre></div>

<p>You can use HTTP:POST to send data to server by using localhost:8080/test/SaveName and your post parameters should be named as “name” and “surName”.It is the simplest thing you can do with jetty embedded server.I use it to get data from database using parameters and posting data into database and it’s really fast and lightweight which makes it really feasible.</p>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2014/03/04/android-sqlite-increase-insertion-speed/">
        Increase Insertion Speed on Android SQLite
      </a>
    </h1>

    <time datetime="2014-03-04T18:40:24+02:00" class="post-date">04 Mar 2014</time>

    <p>I’ve been doing some insert operations on Android with 3000 rows to 15000 rows.A service was planned to update for every one hour and insert all over again.The problem with that it was so slow.Inserting 3000 rows took 150 seconds and there was many tables with that kind of data it will not be able to insert even in one hour.I was using the usual way to do it with ContentValues.Please be aware it’s a set function so I deleted the datas before inserting anything.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">setData</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">YourObject</span><span class="o">&gt;</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">retval</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">&quot;table_data&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">YourObject</span> <span class="n">object</span> <span class="o">:</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ContentValues</span> <span class="n">contentValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ID&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;NAME&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ABBR&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">abbr</span><span class="o">);</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;FOUND_YEAR&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">foundYear</span><span class="o">);</span>
                <span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;table_data&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;setData exception&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> 
<span class="o">}</span></code></pre></div>

<p>After some digging I found nnother method to insert data into the database by using SqliteStatements.You can check the details of SqliteStatement here. Combining transactions with compiled statements yielded a tremendous performance boost: From the original 150 seconds on the Android device (Asus TF300) down to an incredible 1.5 seconds.We had to make sure it is really inserting the data to database and it was successful.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">setData</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">YourObject</span><span class="o">&gt;</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">INSERT_DATA</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO table_data VALUES (?,?,?,?);&quot;</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">retval</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">&quot;table_data&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">SQLiteStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">compileStatement</span><span class="o">(</span><span class="n">INSERT_DATA</span><span class="o">);</span>
            <span class="n">db</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">YourObject</span> <span class="n">object</span> <span class="o">:</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">clearBindings</span><span class="o">();</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">bindLong</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">bindString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">bindString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">abbr</span><span class="o">);</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">bindLong</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">foundYear</span><span class="o">);</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">db</span><span class="o">.</span><span class="na">setTransactionSuccessful</span><span class="o">();</span>
            <span class="n">db</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;setData exception&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">retval</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2014/03/04/android-sqlite-example/">
        Android Sqlite Example
      </a>
    </h1>

    <time datetime="2014-03-04T18:40:24+02:00" class="post-date">04 Mar 2014</time>

    <p>SQLite is embedded into every Android device. Using an SQLite database in Android does not require a setup procedure or administration of the database. You only have to define the SQL statements for creating and updating the database. Afterwards the database is automatically managed for you by the Android platform.</p>

<p>If your application creates a database, this database is by default saved in the directory DATA/data/APP_NAME/databases/FILENAME. The parts of the above directory are constructed based on the following rules. DATA is the path which the Environment.getDataDirectory() method returns. APP_NAME is your application name. FILENAME is the name you specify in your application code for the database.</p>

<p>To create and upgrade a database you have to create a subclass of the SQLiteOpenHelper so you have to extend SQLiteOpenHelper when you define a database class.Here the simplest example how you create a database named “mydb” and a table in it as “data”.You have to override onCreate() and onUpgrade() methods.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyDb</span> <span class="kd">extends</span> <span class="n">SQLiteOpenHelper</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MyDb&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">VERSION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DATABASENAME</span> <span class="o">=</span> <span class="s">&quot;mydb&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MyDb</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">DATABASENAME</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">VERSION</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">db</span><span class="o">.</span><span class="na">execSQL</span><span class="o">(</span><span class="s">&quot;CREATE TABLE IF NOT EXISTS data&quot;</span> <span class="o">+</span>
            <span class="o">+</span> <span class="s">&quot; (ID INTEGER PRIMARY KEY, &quot;</span>
            <span class="o">+</span> <span class="s">&quot;DATA_ID TEXT, &quot;</span>
            <span class="o">+</span> <span class="s">&quot;VALUE TEXT);&quot;</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onUpgrade</span><span class="o">(</span><span class="n">SQLiteDatabase</span> <span class="n">db</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldVersion</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newVersion</span><span class="o">)</span> <span class="o">{</span>
        
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>The SQLiteOpenHelper class provides the getReadableDatabase() and getWriteableDatabase() methods to get access to an SQLiteDatabase object; either in read or write mode.Also SQLiteDatabase provides insert(), update(), delete(), and query methods.To make a query you can use either of rawquery() or query().Also keep this mind that you should always make sure you use methods as synchronized.Here another example of adding data into database and retrieving from it.</p>

<p>We want to use synchronized for every database operation method to avoid from getting database locked errors. I used a list of objects which are “Data” objects that make things more readable but you can use just an object or even use only the areas like objects that make things more readable but you can use just an object or even use only the areas like (long _id, long _dataId, String _value).All the database operations are done in try-catch-finally block and returning a boolean value to show if the insertion was successful or not is the convenient way to do it. ContentValues is the class given by Android and its required for any database operation.</p>

<p>REMARK:You will see a commented out code which is db.insertWithOnConflict method that is a very good way to insert with insertion algorithms at the end. I used SQLiteDatabase.CONFLICT_REPLACE which basicly updates the old one with the new one if it’s already in the database. And after the all operations are done always remember to close database otherwise you will get errors saying that database is already opened.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">addData</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">YourObject</span><span class="o">&gt;</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">retval</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">YourObject</span> <span class="n">object</span> <span class="o">:</span> <span class="n">_objects</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ContentValues</span> <span class="n">contentValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ContentValues</span><span class="o">();</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;ID&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;DATA_ID&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">dataId</span><span class="o">);</span>
                <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;VALUE&quot;</span><span class="o">,</span> <span class="n">object</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
                <span class="n">db</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="n">contentValues</span><span class="o">);</span>
<span class="c1">//db.insertWithOnConflict(&quot;data&quot;, null, contentValues, SQLiteDatabase.CONFLICT_REPLACE);</span>
            <span class="o">}</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;addData exception&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">retval</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>Queries can be created via the rawQuery() and query() methods or via the SQLiteQueryBuilder class . rawQuery() directly accepts an SQL select statement as input. query() provides a structured interface for specifying the SQL query. SQLiteQueryBuilder is a convenience class that helps to build SQL queries.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">String</span> <span class="nf">getDataValue</span><span class="o">(</span><span class="kt">long</span> <span class="n">_id</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SQLiteDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getReadableDatabase</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">retval</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;VALUE&quot;</span><span class="o">},</span>
                    <span class="s">&quot;ID = ?&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">_id</span><span class="o">)},</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToFirst</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">do</span> <span class="o">{</span>
                        <span class="n">retval</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Cannot get data value:&quot;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">retval</span><span class="o">;</span>
<span class="o">}</span></code></pre></div>

<p>The following gives an example of a rawQuery() and a query() call.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">getReadableDatabase</span><span class="o">().</span>
  <span class="n">rawQuery</span><span class="o">(</span><span class="s">&quot;select * from data where ID = ?&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">_id</span> <span class="o">});</span>
 
<span class="n">database</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">,</span> 
  <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">ID</span><span class="o">,</span> <span class="n">DATA_ID</span><span class="o">,</span> <span class="n">VALUE</span> <span class="o">},</span> 
  <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span></code></pre></div>

<p>Parameters of the query() method</p>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
</style>

<table class="tg">
  <tr>
    <th class="tg-031e">Parameters</th>
    <th class="tg-031e">Values</th>
  </tr>
  <tr>
    <td class="tg-031e">String dbName</td>
    <td class="tg-031e">The table name to compile the query against.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] columnNames</td>
    <td class="tg-031e">A list of which table columns to return. Passing "null" will return all columns.</td>
  </tr>
  <tr>
    <td class="tg-031e">String whereClause</td>
    <td class="tg-031e">Where-clause, i.e. filter for the selection of data, null will select all data.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] selectionArgs</td>
    <td class="tg-031e">You may include ?s in the "whereClause"". These placeholders will get replaced by the values
 from the selectionArgs array.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] groupBy</td>
    <td class="tg-031e">A filter declaring how to group rows, null will cause the rows to not be grouped.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] having</td>
    <td class="tg-031e">Filter for the groups, null means no filter.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] orderBy</td>
    <td class="tg-031e">Table columns which will be used to order the data, null means no ordering.</td>
  </tr>
</table>
<p>After you have all database create, upgrade, add, and a get method how you will call it from the activity?Here is the how your main activity look like.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">db</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">&quot;MyDbActivity&quot;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">MyDb</span> <span class="n">MyDb</span><span class="o">;</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
        <span class="n">MyDb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MyDb</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Data</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2032</span><span class="o">,</span> <span class="s">&quot;data1&quot;</span><span class="o">));</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">MyDb</span><span class="o">.</span><span class="na">addData</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;Data value is:&quot;</span><span class="o">,</span> <span class="n">MyDb</span><span class="o">.</span><span class="na">getDataValue</span><span class="o">(</span><span class="mi">1L</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
 
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="n">MyDb</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">MyDb</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
 
        <span class="kd">public</span> <span class="kt">long</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">long</span> <span class="n">dataId</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
 
        <span class="kd">public</span> <span class="nf">Data</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>
 
        <span class="kd">public</span> <span class="nf">Data</span><span class="o">(</span><span class="kt">long</span> <span class="n">_id</span><span class="o">,</span> <span class="kt">long</span> <span class="n">_dataId</span><span class="o">,</span> <span class="n">String</span> <span class="n">_value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">_id</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">dataId</span> <span class="o">=</span> <span class="n">_dataId</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">_value</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>You can download both mainactivity and db class from the links given below:
MainActivity:<a href="https://gist.github.com/msdalp/9297781">Github Link</a>
Db Class: <a href="https://gist.github.com/msdalp/9297983">Github Link</a></p>


  </article>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="/page2">Newer</a>
    
  
</div>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-07-03T15:01:29+03:00">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
