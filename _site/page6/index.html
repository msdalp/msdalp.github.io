<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      msdalp &middot; java, android, etc.
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89611351-1', 'auto');
  ga('send', 'pageview');

</script>
  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="msdalp" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
      <h3 class="masthead-title">
<a href="/" title="Home">msdalp</a>
<small>java, android, etc.</small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/about">About</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/archive">Archive</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/atom.xml">Feed</a></small>


</h3>

      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2014/03/04/android-sqlite-increase-insertion-speed/">
        Increase Insertion Speed on Android SQLite
      </a>
    </h1>

    <time datetime="2014-03-04T17:40:24+01:00" class="post-date">04 Mar 2014</time>

    I've been doing some insert operations on Android with 3000 rows to 15000 rows.A service was planned to update for every one hour and insert all over again.The problem with that it was so slow.Inserting 3000 rows took 150 seconds and there was many tables with that kind of data it will not be able to insert even in one hour.I was using the usual way to do it with ContentValues.Please be aware it's a set function so I deleted the datas before inserting anything.

{% highlight java %}
public synchronized boolean setData(List<YourObject> _objects) {
        final SQLiteDatabase db = this.getWritableDatabase();
        boolean retval = false;
        try {
            db.delete("table_data", null, null);
            for (YourObject object : _objects) {
                ContentValues contentValues = new ContentValues();
                contentValues.put("ID", object.id);
                contentValues.put("NAME", object.name);
                contentValues.put("ABBR", object.abbr);
                contentValues.put("FOUND_YEAR", object.foundYear);
                db.insert("table_data", null, contentValues);
            }
            retval = true;
        } catch (Exception ex) {
            Log.e(TAG, "setData exception", ex);
        } finally {
            db.close();
        }
        return 
}
{% endhighlight %}
After some digging I found nnother method to insert data into the database by using SqliteStatements.You can check the details of SqliteStatement here. Combining transactions with compiled statements yielded a tremendous performance boost: From the original 150 seconds on the Android device (Asus TF300) down to an incredible 1.5 seconds.We had to make sure it is really inserting the data to database and it was successful.

{% highlight java %}
public synchronized boolean setData(List<YourObject> _objects) {
        final SQLiteDatabase db = this.getWritableDatabase();
        final String INSERT_DATA = "INSERT INTO table_data VALUES (?,?,?,?);";
        boolean retval = false;
        try {
            db.delete("table_data", null, null);
            SQLiteStatement statement = db.compileStatement(INSERT_DATA);
            db.beginTransaction();
            for (YourObject object : _objects) {
                statement.clearBindings();
                statement.bindLong(1, object.id);
                statement.bindString(2, object.name);
                statement.bindString(3, object.abbr);
                statement.bindLong(4, object.foundYear);
                statement.execute();
            }
            db.setTransactionSuccessful();
            db.endTransaction();
            retval = true;
        } catch (Exception ex) {
            Log.e(TAG, "setData exception", ex);
        } finally {
            db.close();
        }
        return retval;
}
{% endhighlight %}

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2014/03/04/android-sqlite-example/">
        Android Sqlite Example
      </a>
    </h1>

    <time datetime="2014-03-04T17:40:24+01:00" class="post-date">04 Mar 2014</time>

    SQLite is embedded into every Android device. Using an SQLite database in Android does not require a setup procedure or administration of the database. You only have to define the SQL statements for creating and updating the database. Afterwards the database is automatically managed for you by the Android platform.

If your application creates a database, this database is by default saved in the directory DATA/data/APP\_NAME/databases/FILENAME. The parts of the above directory are constructed based on the following rules. DATA is the path which the Environment.getDataDirectory() method returns. APP\_NAME is your application name. FILENAME is the name you specify in your application code for the database.

To create and upgrade a database you have to create a subclass of the SQLiteOpenHelper so you have to extend SQLiteOpenHelper when you define a database class.Here the simplest example how you create a database named "mydb" and a table in it as "data".You have to override onCreate() and onUpgrade() methods.


{% highlight java %}
  public class MyDb extends SQLiteOpenHelper {
 
    public static final String TAG = "MyDb";
    public static final int VERSION = 1;
    public static final String DATABASENAME = "mydb";
    public MyDb(Context context) {
        super(context, DATABASENAME, null, VERSION);
    }
 
    @Override
    public void onCreate(SQLiteDatabase db) {
        db.execSQL("CREATE TABLE IF NOT EXISTS data" +
            + " (ID INTEGER PRIMARY KEY, "
            + "DATA_ID TEXT, "
            + "VALUE TEXT);");
    }
 
    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        
    }
}
{% endhighlight %}

The SQLiteOpenHelper class provides the getReadableDatabase() and getWriteableDatabase() methods to get access to an SQLiteDatabase object; either in read or write mode.Also SQLiteDatabase provides insert(), update(), delete(), and query methods.To make a query you can use either of rawquery() or query().Also keep this mind that you should always make sure you use methods as synchronized.Here another example of adding data into database and retrieving from it.

We want to use synchronized for every database operation method to avoid from getting database locked errors. I used a list of objects which are "Data" objects that make things more readable but you can use just an object or even use only the areas like objects that make things more readable but you can use just an object or even use only the areas like (long \_id, long \_dataId, String \_value).All the database operations are done in try-catch-finally block and returning a boolean value to show if the insertion was successful or not is the convenient way to do it. ContentValues is the class given by Android and its required for any database operation.

REMARK:You will see a commented out code which is db.insertWithOnConflict method that is a very good way to insert with insertion algorithms at the end. I used SQLiteDatabase.CONFLICT\_REPLACE which basicly updates the old one with the new one if it's already in the database. And after the all operations are done always remember to close database otherwise you will get errors saying that database is already opened.
{% highlight java %}
public synchronized boolean addData(List<YourObject> _objects) {
        final SQLiteDatabase db = this.getWritableDatabase();
        boolean retval = false;
        try {
            for (YourObject object : _objects) {
                ContentValues contentValues = new ContentValues();
                contentValues.put("ID", object.id);
                contentValues.put("DATA_ID", object.dataId);
                contentValues.put("VALUE", object.value);
                db.insert("data",null,contentValues);
//db.insertWithOnConflict("data", null, contentValues, SQLiteDatabase.CONFLICT_REPLACE);
            }
            retval = true;
        } catch (Exception ex) {
            Log.e(TAG, "addData exception", ex);
        } finally {
            db.close();
        }
        return retval;
}
{% endhighlight %}
Queries can be created via the rawQuery() and query() methods or via the SQLiteQueryBuilder class . rawQuery() directly accepts an SQL select statement as input. query() provides a structured interface for specifying the SQL query. SQLiteQueryBuilder is a convenience class that helps to build SQL queries.
{% highlight java %}
public synchronized String getDataValue(long _id) {
        final SQLiteDatabase db = this.getReadableDatabase();
        String retval = null;
        try {
            Cursor cursor = db.query("data", new String[]{"VALUE"},
                    "ID = ?", new String[]{String.valueOf(_id)}, null, null, null);
            if (cursor != null) {
                if (cursor.moveToFirst()) {
                    do {
                        retval = cursor.getString(0);
                    } while (cursor.moveToNext());
                }
            }
        } catch (Exception ex) {
            retval = null;
            Log.e(TAG, "Cannot get data value:", ex);
        } finally {
            db.close();
        }
        return retval;
}
{% endhighlight %}
The following gives an example of a rawQuery() and a query() call.
{% highlight java %}
Cursor cursor = getReadableDatabase().
  rawQuery("select * from data where ID = ?", new String[] { _id });
 
database.query("data", 
  new String[] { ID, DATA_ID, VALUE }, 
  null, null, null, null, null);
{% endhighlight %}
Parameters of the query() method

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
</style>
<table class="tg">
  <tr>
    <th class="tg-031e">Parameters</th>
    <th class="tg-031e">Values</th>
  </tr>
  <tr>
    <td class="tg-031e">String dbName</td>
    <td class="tg-031e">The table name to compile the query against.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] columnNames</td>
    <td class="tg-031e">A list of which table columns to return. Passing "null" will return all columns.</td>
  </tr>
  <tr>
    <td class="tg-031e">String whereClause</td>
    <td class="tg-031e">Where-clause, i.e. filter for the selection of data, null will select all data.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] selectionArgs</td>
    <td class="tg-031e">You may include ?s in the "whereClause"". These placeholders will get replaced by the values
 from the selectionArgs array.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] groupBy</td>
    <td class="tg-031e">A filter declaring how to group rows, null will cause the rows to not be grouped.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] having</td>
    <td class="tg-031e">Filter for the groups, null means no filter.</td>
  </tr>
  <tr>
    <td class="tg-031e">String[] orderBy</td>
    <td class="tg-031e">Table columns which will be used to order the data, null means no ordering.</td>
  </tr>
</table>
After you have all database create, upgrade, add, and a get method how you will call it from the activity?Here is the how your main activity look like.
{% highlight java %}
package com.test.db;
 
import android.app.Activity;
import android.os.Bundle;
import android.util.Log;
import java.util.LinkedList;
import java.util.List;
 
public class MainActivity extends Activity {
 
    public static String TAG = "MyDbActivity";
    public static MyDb MyDb;
 
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        MyDb = new MyDb(this);
        List<Data> data = new LinkedList<Data>();
        data.add(new Data(1, 2032, "data1"));
        if (MyDb.addData(data)) {
            Log.d("Data value is:", MyDb.getDataValue(1L));
        }
    }
 
    @Override
    protected void onDestroy() {
        super.onDestroy();
        MyDb.close();
        MyDb = null;
    }
 
    public class Data {
 
        public long id;
        public long dataId;
        public String value;
 
        public Data() {
        }
 
        public Data(long _id, long _dataId, String _value) {
            this.id = _id;
            this.dataId = _dataId;
            this.value = _value;
        }
    }
}
{% endhighlight %}
You can download both mainactivity and db class from the links given below:
MainActivity:<a href="https://gist.github.com/msdalp/9297781">Github Link</a>
Db Class: <a href="https://gist.github.com/msdalp/9297983">Github Link</a>


  </article>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    
      <a class="pagination-item newer" href="/page5">Newer</a>
    
  
</div>


      </main>
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // Required: on line below, replace text in quotes with your forum shortname
    var disqus_shortname = 'msdalp';
    // var disqus_developer = 1;

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      <footer class="footer">
        <small>
          &copy; <time datetime="2018-04-16T19:53:39+02:00">2018</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
